<!--
    docker run -it --rm -p 3000:80 --name web -v ~/documents/js-audio:/usr/share/nginx/html nginx
    http://127.0.0.1:3000/octave.html
-->
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=0.7, user-scalable=no" />
    </head>

    <style>
        button {
            background-color: #eee;
            border-radius: 7px;
            height: 400px;
            width: 60px;
            margin: 12px;
        }
        button.black {
            background-color: #666;
            position: relative;
            top: -100px;
            height: 200px;
            width: 40px;
            margin: -30px;
        }
        button.animated {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        	background-size: 400% 400%;
        	animation: gradient 0.5s ease infinite;
        }

        @keyframes gradient {
            0%   { background-position: 0%   50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0%   50%; }
        }
    </style>

    <h1>Всратонино</h1>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key" style="margin-right: 6px;">&nbsp;</button><!--
 --><button class="key" style="margin-left: 6px;">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>

    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key" style="margin-right: 6px;">&nbsp;</button><!--
 --><button class="key" style="margin-left: 6px;">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>
    <button class="key black">&nbsp;</button>
    <button class="key">&nbsp;</button>

    <script>
        // create web audio api context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playFreq(audioCtx, freq, duration) {
            const gainNode = audioCtx.createGain();
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime+duration);

            const osc = audioCtx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime); // value in hertz

            osc.connect(gainNode).connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function addClass(el, duration) {
            if (!el.dataset.animationTimer) {
                el.classList.add("animated");
                el.dataset.animationTimer = setTimeout(function() {
                    el.classList.remove("animated"); el.dataset.animationTimer='';
                }, duration*1000);
            } else {
                clearTimeout(el.dataset.animationTimer);
                el.dataset.animationTimer = setTimeout(function() {
                    el.classList.remove("animated"); el.dataset.animationTimer='';
                }, duration*1000);
            }
        }

        document.querySelectorAll('button.key').forEach((btn, i) => {
            const freq = 2**((i+40-49)/12)*440;
            const duration = 2;
            btn.onmousedown = function() { playFreq(audioCtx, freq, duration); addClass(btn, duration) };
            btn.ontouchstart = function() { playFreq(audioCtx, freq, duration); addClass(btn, duration) };
        });
    </script>
</html>

